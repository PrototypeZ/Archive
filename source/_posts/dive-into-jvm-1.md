---
title: 深入浅出 Java 虚拟机（一）
tags: 
date: 2018-11-01 21:03:00
desc: 《深入理解 Java 虚拟机》 读书笔记
---

最近读了一本书，《深入理解 Java 虚拟机》，我认为写得非常好，感觉这本书为我打开了一个新的世界。虽然作为一个应用层开发人员，大多数时候我们是不需要理解底层虚拟机的运行机制的，事实上，这正是 Java 虚拟机设计的优秀之处，对开发人员完全屏蔽了运行时的绝大多数细节。但正是如此，我觉得我们更应该深入探索 JVM 。

<!-- More -->

## Java 虚拟机所使用的进程

一个虚拟机实例运行在一个操作系统进程之上。


## 术语定义

1. Slot： 局部变量空间单位

## 对 Java 虚拟机所使用的内存区域进行划分

### 线程专属的内存区域
虚拟机栈（VM Stack），本地方法栈（Native Method Stack），程序计数器（Program Couter Register）

### 非线程专属的内存区域
方法区、堆

## 程序计数器
1. 当前程序所执行的字节码的行号指示器。
2. 字节码解释器工作室就是通过改变这个计数器的值来选取吓一跳需要执行的字节码指令，分支、循环、跳转、异常处理、线程恢复都需要依赖这个计数器来完成。
3. 唯一一个在规范中没有定义 OutOfMemoryError 的区域。
4. 因为我们的程序是多线程环境，所以这块需要存在于线程私有区域。
5. 如果执行的是 Native 方法，计数器值为空。

## 虚拟机栈（VM Stack）
1. 也是线程私有的，声明周期与线程相同。
2. 描述的是 Java **方法执行时** 的内存模型，每个方法被执行的时候都会同时创建一个栈帧（Stack Frame），用于存储局部变量表、操作栈、动态链接、方法出口等信息。
3. 每一个方法被调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。
4. 大家常说的 “堆栈” 中的 “栈” 指的就是虚拟机栈，或者是虚拟机栈中的局部变量表部分。
5. 局部变量表存储的是基本数据类型和对象引用类型（但是真正对象空间在堆分配，这里仅仅是一个指针）和returnAddress 类型。
6. 局部变量表所需的内存空间在编译期分配完成，运行期局部变量表的大小不会发生变化。
7. 当栈深度大于 JVM 所允许的深度时，抛出 StackOverflow 异常，当栈动态扩展但是无法申请到足够的内存时会抛出 OutOfMemoryError 异常。

## 本地方法栈（Native Method Stacks）
1. 也会抛出 StackOverflowError 和 OutOfMemoryError。

## 堆



___
如果您对我的技术分享感兴趣，欢迎关注我的个人公众号：麻瓜日记，不定期更新原创技术分享，谢谢！:)

![](http://prototypez.github.io/images/qrcode.jpg)